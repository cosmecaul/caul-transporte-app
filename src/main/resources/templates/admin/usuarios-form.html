<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title th:text="${pageTitle}">Usuario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Inputs flotantes (mismo estilo que Cliente) */
        .float-label {
            position: relative;
            margin-top: 1.5rem;
        }
        .float-label input,
        .float-label select {
            width: 100%;
            padding: 0.75rem 0.75rem 0.25rem 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 10px;
            background: white;
            outline: none;
        }

        .float-label label {
            position: absolute;
            left: 0.75rem;
            top: 0.85rem;
            color: #64748b;
            cursor: text;
            transition: all .2s ease-out;
        }

        .float-label input:focus + label,
        .float-label input:not(:placeholder-shown) + label,
        .float-label select:focus + label,
        .float-label select:not([value=""]) + label {
            top: -0.55rem;
            left: 0.6rem;
            font-size: 0.7rem;
            background: white;
            padding: 0 0.25rem;
            color: #0f172a;
        }
    </style>
</head>

<body class="bg-slate-100 min-h-screen">

<div class="max-w-3xl mx-auto py-6 px-4">

    <!-- Header -->
    <div class="flex items-center justify-between mb-4">
        <h1 class="text-xl font-semibold text-slate-900" th:text="${pageTitle}">Usuario</h1>

        <a href="/admin/usuarios"
           class="px-3 py-1 rounded-full border border-slate-300 text-slate-700 hover:bg-slate-100 text-xs">
            ← Volver
        </a>
    </div>

    <!-- Tarjeta del formulario -->
    <div class="bg-white rounded-2xl shadow-sm border p-5">

        <!-- IMPORTANTE: el form es el contexto para #fields (si usas validación) -->
        <form th:object="${form}"
              th:action="${usuarioId != null} ? @{/admin/usuarios/{id}/editar(id=${usuarioId})} : @{/admin/usuarios/nuevo}"
              method="post"
              class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <!-- ERRORES GLOBALES (opcional si usas BindingResult) -->
            <div th:if="${#fields != null and #fields.hasErrors('*')}"
                 class="col-span-2 mb-2 px-4 py-3 bg-red-50 text-red-700 border border-red-200 rounded-xl text-xs">
                <ul class="list-disc list-inside space-y-1">
                    <li th:each="err : ${#fields.errors('*')}"
                        th:text="${err}">Error</li>
                </ul>
            </div>

            <!-- NOMBRE USUARIO (solo lectura en edición) -->
            <div class="float-label col-span-2">
                <input type="text"
                       placeholder=" "
                       th:value="${usuarioUsername}"
                       disabled
                       class="peer" />
                <label>Nombre de usuario</label>
            </div>

            <!-- NOMBRE COMPLETO -->
            <div class="float-label col-span-2">
                <input type="text" th:field="*{nombreCompleto}" placeholder=" ">
                <label>Nombre completo</label>
            </div>

            <!-- RUT -->
            <div class="float-label">
                <input type="text" th:field="*{rut}" placeholder=" ">
                <label>RUT</label>
            </div>

            <!-- EMAIL -->
            <div class="float-label">
                <input type="email" th:field="*{email}" placeholder=" ">
                <label>Email</label>
            </div>

            <!-- ROL -->
            <div class="float-label">
                <select th:field="*{rol}">
                    <option value="">Seleccionar</option>
                    <option value="ADMIN">Administrador</option>
                    <option value="OPERADOR">Operador</option>
                    <option value="CONDUCTOR">Conductor</option>
                    <option value="CLIENTE_CORP">Cliente corporativo</option>
                </select>
                <label>Rol</label>
            </div>

            <!-- CLIENTE ASOCIADO -->
            <div class="float-label">
                <input type="number" th:field="*{idCliente}" placeholder=" ">
                <label>Cliente asociado (opcional)</label>
            </div>

            <!-- ACTIVO -->
            <div class="float-label">
                <select th:field="*{activo}">
                    <option value="true">Activo</option>
                    <option value="false">Inactivo</option>
                </select>
                <label>Estado</label>
            </div>

            <!-- PASSWORD NUEVA (opcional en edición) -->
            <div class="float-label">
                <input type="password" th:field="*{passwordNuevo}" placeholder=" ">
                <label>Nueva contraseña (opcional)</label>
            </div>

            <!-- BOTÓN GUARDAR -->
            <div class="col-span-2 mt-4 flex justify-end gap-2">
                <a href="/admin/usuarios"
                   class="px-4 py-2 rounded-full border border-slate-300 text-slate-700 hover:bg-slate-50 text-sm">
                    Cancelar
                </a>
                <button type="submit"
                        class="px-5 py-2 bg-slate-900 text-white text-sm rounded-full hover:bg-slate-800">
                    Guardar cambios
                </button>
            </div>

        </form>
    </div>
</div>

</body>
</html>

